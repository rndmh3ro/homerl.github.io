<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ssd,raid,interface," />





  <link rel="alternate" href="/atom.xml" title="Homer's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="Chipset Bottlenecks can occur SSDs in a RAIDEvaluate the I/O topology of the used machine and eliminate bottleneckse.g., distribute SSDs to multiple controllers
Where is your ssd connectted ?Some sata">
<meta property="og:type" content="article">
<meta property="og:title" content="Raid in SSD">
<meta property="og:url" content="http://yoursite.com/2016/04/25/Raid-in-SSD/index.html">
<meta property="og:site_name" content="Homer's Blog">
<meta property="og:description" content="Chipset Bottlenecks can occur SSDs in a RAIDEvaluate the I/O topology of the used machine and eliminate bottleneckse.g., distribute SSDs to multiple controllers
Where is your ssd connectted ?Some sata">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/5/53/Intel_5_Series_architecture.png">
<meta property="og:image" content="http://www.ssdfans.com/wp-content/uploads/2016/04/041316_0813_FTLOP12.png">
<meta property="og:updated_time" content="2016-05-13T06:00:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Raid in SSD">
<meta name="twitter:description" content="Chipset Bottlenecks can occur SSDs in a RAIDEvaluate the I/O topology of the used machine and eliminate bottleneckse.g., distribute SSDs to multiple controllers
Where is your ssd connectted ?Some sata">
<meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/5/53/Intel_5_Series_architecture.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Raid in SSD | Homer's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Homer's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tools">
          <a href="/tools" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat fa-fw"></i> <br />
            
            Tools
          </a>
        </li>
      
        
        <li class="menu-item menu-item-rss">
          <a href="/atom.xml" rel="section">
            
              <i class="menu-item-icon fa fa-rss fa-fw"></i> <br />
            
            Rss
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'K4XNzEUeT9VohamGXb51','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Raid in SSD
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-25T20:28:13+08:00" content="2016-04-25">
              2016-04-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Hardware/" itemprop="url" rel="index">
                    <span itemprop="name">Hardware</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/25/Raid-in-SSD/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/04/25/Raid-in-SSD/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Chipset-Bottlenecks-can-occur-SSDs-in-a-RAID"><a href="#Chipset-Bottlenecks-can-occur-SSDs-in-a-RAID" class="headerlink" title="Chipset Bottlenecks can occur SSDs in a RAID"></a>Chipset Bottlenecks can occur SSDs in a RAID</h3><p>Evaluate the I/O topology of the used machine and eliminate bottlenecks<br>e.g., distribute SSDs to multiple controllers</p>
<p>Where is your ssd connectted ?<br>Some sata/M.2 ports through DMI conencetted.<br><img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Intel_5_Series_architecture.png" alt=""></p>
<p>DMI bandwidth<br>DMI 2.0, introduced in 2011, doubles the data transfer rate to 2 GB/s with a ×4 link. It is used to link an Intel CPU with the Intel Platform Controller Hub (PCH), which supersedes the historic implementation of a separate northbridge and southbridge.</p>
<p>DMI 3.0, released in August 2015, allows the 8 GT/s transfer rate per lane, for a total of four lanes and <font color="green">3.93 GB/s</font> for the CPU–PCH link. It is used by two-chip variants of the Intel Skylake microprocessors, which are used in conjunction with Intel 100 Series chipsets</p>
<p>Popular server only DMI 2.0 shipset at 2016-04<br>For example<br><a href="http://www.supermicro.com/products/system/1U/1028/SYS-1028U-E1CR4_.cfm" target="_blank" rel="external">Supermicro 1028U-E1CR4+</a><br><a href="http://www.supermicro.com/products/system/1U/1028/SYS-1028U-TN10RT_.cfm" target="_blank" rel="external">Same with 1028U-TN10RT+</a><br><a href="http://ark.intel.com/products/81759/Intel-DH82029-PCH" target="_blank" rel="external">Intel C612 chipset</a></p>
<h3 id="Enterprise-class-hardware-RAID-controllers-IOPS-bottlenecks"><a href="#Enterprise-class-hardware-RAID-controllers-IOPS-bottlenecks" class="headerlink" title="Enterprise-class hardware RAID controllers IOPS bottlenecks"></a>Enterprise-class hardware RAID controllers IOPS bottlenecks</h3><ul>
<li>Use software RAID to overcome the performance limitations of hardware RAID</li>
<li>Bottlenecks in software RAID implementations can still occur though at higher performance level</li>
</ul>
<h3 id="Asymmetry-between-Read-Write-Speed"><a href="#Asymmetry-between-Read-Write-Speed" class="headerlink" title="Asymmetry between Read/Write Speed"></a>Asymmetry between Read/Write Speed</h3><ul>
<li>Reading flash pages faster than writing</li>
<li>Writes in parity-based RAIDs slower than reads due to Read-Modify-Write operations</li>
<li>Effects can accumulate Even faster reads and slower writes</li>
</ul>
<h3 id="Synchronous-SSD-Aging"><a href="#Synchronous-SSD-Aging" class="headerlink" title="Synchronous SSD Aging"></a>Synchronous SSD Aging</h3><ul>
<li>SSDs have limited number of erase cycles<ul>
<li>Lifespan of SSD depends on write workload</li>
</ul>
</li>
<li>In RAIDs writes often distributed equally to all drives<ul>
<li>Multiple drives may wear out at the same time </li>
</ul>
</li>
</ul>
<p>If broken ssd just read only ,that is fine<br>Until 2016, I think write endurance is not problem.</p>
<h3 id="Workload-History-Dependency"><a href="#Workload-History-Dependency" class="headerlink" title="Workload History Dependency"></a>Workload History Dependency</h3><ul>
<li>Increase spare capacity to ensure that enough free flash blocks will be available anytime</li>
<li>Garbage collector</li>
<li>Write amplification</li>
</ul>
<p>OP (Over Provisioning) is very important for Garbage collector and write amplification</p>
<p>More OP, More perforamnce, Lower fragments(Lower write amplification), More write endurance….</p>
<p><a href="http://www.anandtech.com/show/8954/intel-launches-ssd-dc-s3610-s3710-enterprise-ssds" target="_blank" rel="external">There’s a difference in over-provisioning levels too as the S3710 features a higher 30-40% over-provisioning with the S3610 having only 10-20%, in both models the exact over-provisioning depends on the capacity</a></p>
<p><a href="http://www.anandtech.com/show/9455/samsung-releases-pm863-sm863-enterprise-sata-ssds-up-to-384tb-with-3d-vnand" target="_blank" rel="external">The SM863 actually provides lower random write performance than the 845DC PRO, which is due to the reduced default over-provisioning as the SM863 only has 12% compared to 28% in the 845DC PRO</a></p>
<p><img src="http://www.ssdfans.com/wp-content/uploads/2016/04/041316_0813_FTLOP12.png" alt=""></p>
<h3 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h3><p><a href="http://www.tomshardware.com/reviews/ssd-dc-s3500-raid-performance,3613-7.html" target="_blank" rel="external">6x dc s3500 raid performance</a><br><a href="http://www.phoronix.com/scan.php?page=article&amp;item=linux_raid_fs4&amp;num=1" target="_blank" rel="external">4x intel 530 raid performance</a></p>
<p>In intel’ s <a href="http://www.intel.com/content/dam/www/public/us/en/documents/white-papers/ssd-server-storage-applications-paper.pdf" target="_blank" rel="external">ssd-server-storage-applications-paper</a><br>The document said “With SSDs, RAID level selection criteria are similar to HDDs. However, because of shorter rebuild times under load and lower performance cost of reads during Read-Modify-Write operations, RAID 5/6/50/60 may be more effective in some applications that traditionally would require the use of RAID 10 with HDDs.”</p>
<p>Does it means you could run SSDs in raid 50/60 (intel hardware) ?</p>
<h3 id="Congfiguration"><a href="#Congfiguration" class="headerlink" title="Congfiguration"></a>Congfiguration</h3><h4 id="Posix-file-system"><a href="#Posix-file-system" class="headerlink" title="Posix file system"></a>Posix file system</h4><p>kernel version &gt; 3.7 (ext4,btrfs,xfs,jfs)<br>add “discard” tag on each partition of the SSD<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/sda1 / ext4 defaults,noatime,discard 0 1</span><br></pre></td></tr></table></figure></p>
<h4 id="Secure-Erase"><a href="#Secure-Erase" class="headerlink" title="Secure Erase"></a>Secure Erase</h4><p>wiping out all fragmentation and physically erasing all NAND blocks<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hdparm --user-master master --security-set-pass password /dev/sdX</span><br><span class="line">hdparm --user-master master --security-erase password /dev/sdX</span><br><span class="line">hdparm -Np468862128 /dev/sdX <span class="comment">#PIO mode</span></span><br><span class="line">&lt;Power cycle the drive&gt;</span><br></pre></td></tr></table></figure></p>
<p>ATA defines two classes of transfer mode, called PIO Mode (Programmed I/O Mode) and DMA Mode (Direct Memory Access Mode). PIO mode transfers are much slower and require the processor to arbitrate transfers between the device and memory. DMA mode transfers are much faster and occur without processor intervention</p>
<h4 id="Enable-HPA-not-Recommended"><a href="#Enable-HPA-not-Recommended" class="headerlink" title="Enable HPA (not Recommended)"></a>Enable HPA (not Recommended)</h4><p>(Recommended) Create partition(s) that occupy only the desired usable capacity and leave the<br>remaining capacity unused</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">User Capacity:    900,184,411,136 bytes [900 GB]</span><br><span class="line">awk <span class="string">'BEGIN&#123;print 900184411136/1024/1024/1024&#125;'</span></span><br><span class="line">838.362</span><br><span class="line">hdparm -N /dev/sdb</span><br><span class="line">max sectors = 1953525168/1953525168, HPA is disabled</span><br><span class="line">awk <span class="string">'BEGIN&#123;print 1953525168*512/1024/1024/1024&#125;'</span></span><br><span class="line">931.513</span><br><span class="line"><span class="comment"># Setting 80% could be used, improve OP capacity</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;printf "%0.2f",1953525168*0.8&#125;'</span></span><br><span class="line">1562820134.40</span><br><span class="line">hdparm -Np1562820134 --yes-i-know-what-i-am-doing /dev/sdb</span><br><span class="line"> setting max visible sectors to 1562820134 (permanent)</span><br><span class="line"> max sectors   = 1562820134/1953525168, HPA is enabled</span><br><span class="line"></span><br><span class="line"><span class="comment">#Available space</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;print 1562820134*512/1024/1024/1024&#125;'</span></span><br><span class="line">745.211</span><br></pre></td></tr></table></figure>
<h4 id="Enable-HPA-in-Kernel-Boot-Parameters"><a href="#Enable-HPA-in-Kernel-Boot-Parameters" class="headerlink" title="Enable HPA in Kernel Boot Parameters"></a><a href="http://redsymbol.net/linux-kernel-boot-parameters/" target="_blank" rel="external">Enable HPA in Kernel Boot Parameters</a></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libata.ignore_hpa=      [LIBATA] Ignore HPA limit</span><br><span class="line">                        libata.ignore_hpa=0       keep BIOS limits (default)</span><br><span class="line">                        libata.ignore_hpa=1       ignore limits, using full disk</span><br></pre></td></tr></table></figure>
<p>or<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/module/libata/parameters/ignore_hpa</span><br><span class="line"><span class="built_in">echo</span> options libata ignore_hpa=1 &gt; /etc/modprobe.d/libata.conf</span><br></pre></td></tr></table></figure></p>
<p><a href="https://www.thomas-krenn.com/en/wiki/SSD_Over-provisioning_using_hdparm" target="_blank" rel="external">HPA reference</a></p>
<h4 id="Use-Direct-IO"><a href="#Use-Direct-IO" class="headerlink" title="Use Direct IO"></a>Use Direct IO</h4><p>With SSDs in Linux* using direct IO instead of buffered IO is recommended, when possible. The Linux<br>IO subsystem provides read and write buffering at the block device level. In most cases, buffering is<br>undesirable with SSDs for the following reasons:</p>
<ul>
<li>SSDs have lower latencies than HDDs, therefore the benefits of buffering are reduced.</li>
<li>Buffering read IOs consumes extra CPU cycles for memory copy operations. At IO rates typical for<br>SSDs, this extra CPU consumption may be high and create a read performance bottleneck.<br>To use direct IO and bypass the buffer, software can set O_DIRECT flag when opening a file. Many<br>applications and test tools have configurable options that allow selecting direct or buffered IO, for<br>example:</li>
<li>FIO* utility: use ‘–direct=1’ option</li>
<li>MySQL InnoDB*: use ‘–innodb_flush_method=O_DIRECT’ option</li>
<li>Oracle* 10g/11g: use ‘filesystemio_options = SETALL’ or<br>‘filesystemio_options = DIRECTIO’</li>
</ul>
<h4 id="echo-noop-gt-sys-block-sdX-queue-scheduler"><a href="#echo-noop-gt-sys-block-sdX-queue-scheduler" class="headerlink" title="echo noop &gt; /sys/block/sdX/queue/scheduler"></a>echo noop &gt; /sys/block/sdX/queue/scheduler</h4><h4 id="Raid-setting"><a href="#Raid-setting" class="headerlink" title="Raid setting"></a>Raid setting</h4><p>To optimize the speed of random IOPS, stripe unit size should be at least 2X of the typical transfer size used by the application. This minimizes the frequency of transfers crossing the stripe boundaries and writing to more than one drive at a time. If the files and transfers are aligned on the stripe boundaries, the stripe size can be set to be equal to the typical transfer size.</p>
<p>In large RAID sets, you must verify that your stripe size is large enough so that the stripe per drive is<br>not less than 4KB. To calculate the smallest stripe:<br>4096 X Number_of_Striped_Drives = Smallest_Stripe_Size<br>For higher sequential bandwidth with applications that cannot use IO queuing, the following stripe unit<br>size or smaller should be used:<br>0.5 x Transfer_size / Number_of_striped_drives</p>
<h4 id="How-small-files-save-to-Raid-stripe"><a href="#How-small-files-save-to-Raid-stripe" class="headerlink" title="How small files save to Raid stripe"></a><a href="https://communities.intel.com/thread/17622?tstart=0" target="_blank" rel="external">How small files save to Raid stripe</a></h4><p>That same with what I guess. I ‘m so glad :)</p>
<p>Again please remember that you can write multiple data blocks into one strip. Strip is not the smallest storage unit size on the disk.</p>
<p>Let’s take your example. we have a 32KB file and a 96KB file. On the file system they’re stored in a total of 4 clusters, if you have a 32KB cluster. Let’s say you have a 64KB strip size on RAID controller, and let’s assume it’s a sequential write. The first file will be written on the first 32KB of the strip on the first disk. Then the first 32KB of the 2nd file will be written to the rest 32KB of the strip on the first disk. The remaining 64KB goes to the strip on the second disk.</p>
<p>Now let’s change the example a little bit, with multiple (let’s say eight) 8KB files, 32KB cluster size and 64KB strip size. because of the 32KB cluster size, each 8KB file will use 32KB on your file system. Each 64KB strip can still take two 32KB clusters, so you’re using four strips in total, two on each drive. But you’re wasting 24KB * 8 = 192KB drive space here.</p>
<p>What if your cluster size is 4KB? Each 8KB file will take two clusters, and all 8 files can be stored in one 64KB strip.</p>
<p>What about a 1KB file? If you have a 4KB cluster size and 64KB strip size, you still have 60KB on the strip left for other files, wasting 3KB here, which is inevitable. But if you have a 32KB cluster size, you’ll have only 32KB on the strip left for other files, wasting 31KB.</p>
<p>Using RAID Write-Back Caching (BBU)<br>Disabling RAID Read Ahead, except sequential read bandwidth with single threaded applications<br>Disabling RAID Read Cache, read caching consumes RAID memory that could be used by write-back caching.<br><a href="http://www.intel.com/content/dam/www/public/us/en/documents/white-papers/ssd-server-storage-applications-paper.pdf" target="_blank" rel="external">For more info</a></p>
<h4 id="How-stripe-size"><a href="#How-stripe-size" class="headerlink" title="How stripe size"></a>How stripe size</h4><p><a href="http://www.research.ibm.com/haifa/conferences/systor2011/present/session5_talk2_systor2011.pdf" target="_blank" rel="external">Reference</a><br><a href="https://en.wikipedia.org/wiki/Direct_Media_Interface" target="_blank" rel="external">Reference</a><br><a href="http://www.ssdfans.com/?p=1840" target="_blank" rel="external">Garbage collector  Reference</a><br><a href="https://en.wikipedia.org/wiki/Write_amplification#BG-GC" target="_blank" rel="external">Garbage collector  Reference</a></p>

      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ssd/" rel="tag">#ssd</a>
          
            <a href="/tags/raid/" rel="tag">#raid</a>
          
            <a href="/tags/interface/" rel="tag">#interface</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/04/20/SSD-partition-alignment/" rel="next" title="Partition alignment">
                <i class="fa fa-chevron-left"></i> Partition alignment
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/06/Trim-discard-support/" rel="prev" title="Trim (discard) support">
                Trim (discard) support <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/img/mq1-penn.jpg"
               alt="Homer Li" />
          <p class="site-author-name" itemprop="name">Homer Li</p>
          <p class="site-description motion-element" itemprop="description">The chioce you make, the risks you take</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">63</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">91</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/homerl/" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://plus.google.com/u/0/112219574615546910314" target="_blank">
                  
                    <i class="fa fa-globe"></i> G+
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chipset-Bottlenecks-can-occur-SSDs-in-a-RAID"><span class="nav-number">1.</span> <span class="nav-text">Chipset Bottlenecks can occur SSDs in a RAID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enterprise-class-hardware-RAID-controllers-IOPS-bottlenecks"><span class="nav-number">2.</span> <span class="nav-text">Enterprise-class hardware RAID controllers IOPS bottlenecks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Asymmetry-between-Read-Write-Speed"><span class="nav-number">3.</span> <span class="nav-text">Asymmetry between Read/Write Speed</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Synchronous-SSD-Aging"><span class="nav-number">4.</span> <span class="nav-text">Synchronous SSD Aging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Workload-History-Dependency"><span class="nav-number">5.</span> <span class="nav-text">Workload History Dependency</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Benchmark"><span class="nav-number">6.</span> <span class="nav-text">Benchmark</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Congfiguration"><span class="nav-number">7.</span> <span class="nav-text">Congfiguration</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Posix-file-system"><span class="nav-number">7.1.</span> <span class="nav-text">Posix file system</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Secure-Erase"><span class="nav-number">7.2.</span> <span class="nav-text">Secure Erase</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Enable-HPA-not-Recommended"><span class="nav-number">7.3.</span> <span class="nav-text">Enable HPA (not Recommended)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Enable-HPA-in-Kernel-Boot-Parameters"><span class="nav-number">7.4.</span> <span class="nav-text">Enable HPA in Kernel Boot Parameters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Use-Direct-IO"><span class="nav-number">7.5.</span> <span class="nav-text">Use Direct IO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#echo-noop-gt-sys-block-sdX-queue-scheduler"><span class="nav-number">7.6.</span> <span class="nav-text">echo noop > /sys/block/sdX/queue/scheduler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Raid-setting"><span class="nav-number">7.7.</span> <span class="nav-text">Raid setting</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#How-small-files-save-to-Raid-stripe"><span class="nav-number">7.8.</span> <span class="nav-text">How small files save to Raid stripe</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#How-stripe-size"><span class="nav-number">7.9.</span> <span class="nav-text">How stripe size</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Homer Li</span>
&nbsp&nbsp&nbsp Pageviews: <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
&nbsp&nbsp&nbsp You are the <span id="busuanzi_value_site_uv"></span>th visitor &nbsp&nbsp&nbsp
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.scheme !== 'Pisces' && (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always')) {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'homersblog';
      var disqus_identifier = '2016/04/25/Raid-in-SSD/';
      var disqus_title = 'Raid in SSD';
      var disqus_url = 'http://yoursite.com/2016/04/25/Raid-in-SSD/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  




  
  
  <script type="text/javascript">
    // Popup Window;
    var scrollTop = '';
    var newHeight = '100';

    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;

    // monitor main search box;
    $('#search-input').on('input', function() {
    if ($(this).val().length <= 0) {
      $('#search-result').hide();
      return;
    }
    $('i.search-keyword').text($(this).val());
    $('a.search-result[href!="#"]').each(function(){
      this.href = this.href.replace(/\=(.*?)(?=%20site)/,'='+$('#search-input').val())
    });
    $('#search-result').show();
    });

    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    searchFunc = function(){};
    $.ajax({
        url: path,
        dataType: "xml",
        async: false,
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 100;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                });
                str += "</ul>";
                $resultContent.innerHTML = str;
            });
        }
    });}

    // handle and trigger popup window;
    $(window).bind('scroll', function() {
      scrollTop = $( window ).scrollTop();
      newHeight = scrollTop + 100;
    });
    $('#search-result a').mousedown(function(e) {
        window.location.href = this.href;
      });
    $('.popup-trigger').mousedown(function(e) {
      searchFunc(path, 'local-search-input', 'local-search-result');
      $('#local-search-input').val($('#search-input').val());
      document.getElementById('local-search-input').dispatchEvent(new Event('input'));
      e.stopPropagation();
      if(jQuery(window).width() < 750) {
        $('.site-search-form').after( $( ".popup" ) );
        $('.popup').show().addClass('popup-mobile').css('top', 0);
        $('html, body').animate({
          scrollTop: $('.popup').offset().top
        }, 500);
      } else {
        $('.popup').removeClass('popup-mobile').css('top', newHeight).toggle();
      };
    });

    $('#search-input').focus(function() {
    if ($(this).val().length > 0) {
      $('#search-result').show();
      }
    });
    $('#search-input').blur(function() {
      $('#search-result').hide();
    });

    $('html').click(function() {
      $('.popup').hide();
    });
    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  


</body>
</html>
